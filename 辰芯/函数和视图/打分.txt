select d.id as ryid,d.lastname,d.workcode,a.sjbm,d.jobtitle,a.erjm,case when c.currentnodetype='3' then '已评价' else '评价中' end as status,a.khzqnf as year,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='uf_ygjxzbzdk' and ta.fieldname='khzq' and tc.selectvalue=a.khzq) as zq,b.requestid,convert(varchar(20),b.requestid) as keyid,b.bdbh,b.khzgdf,b.khpjdj,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='formtable_main_51' and ta.fieldname='khpjdj' and tc.selectvalue=b.khpjdj) as khpjdjname,a.ygkhqz from uf_ygjxzbzdk a,formtable_main_51 b,workflow_requestbase c,hrmresource d  where a.id=b.xzyzdd and b.requestid=c.requestid and a.fqr=d.id  and d.departmentid in(11) and d.status<5 and a.khzqnf='2019' and a.khzq='11' 
union all 
select d.id as ryid,d.lastname,d.workcode,a.sjbm,d.jobtitle,a.erjm,'未评价' as status,'2019' as year,'5月' as zq,'' as requestid,convert(varchar(20),a.fqr)+'_'+convert(varchar(20),a.id) as keyid,'' as bdbh,null as khzgdf,'' as khpjdj,'' as khpjdjname,a.ygkhqz from uf_ygjxzbzdk a,hrmresource d  where  a.fqr=d.id  and d.departmentid in(11) and d.status<5 and a.khzqnf='2019' and a.khzq='11' and not exists (select 1 from formtable_main_51 where xzyzdd=a.id ) 
union all 
select d.id as ryid,d.lastname,d.workcode,a.sjbm,d.jobtitle,a.erjm,case when c.currentnodetype='3' then '已评价' else '评价中' end as status,a.khzqnf as year,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='uf_ygjxzbzdk' and ta.fieldname='khzq' and tc.selectvalue=a.khzq) as zq,b.requestid,convert(varchar(20),b.requestid) as keyid,b.bdbh,b.khzgdf,b.khpjdj,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='formtable_main_51' and ta.fieldname='khpjdj' and tc.selectvalue=b.khpjdj) as khpjdjname,a.ygkhqz from uf_ygjxzbzdk a,formtable_main_51 b,workflow_requestbase c,hrmresource d  where a.id=b.xzyzdd and b.requestid=c.requestid and a.fqr=d.id  and d.departmentid not in(11) and a.jxssbm in(11)  and d.status<5 and a.khzqnf='2019' and a.khzq='11' 
union all
select d.id as ryid,d.lastname,d.workcode,a.sjbm,d.jobtitle,a.erjm,'未评价' as status,'2019' as year,'5月' as zq,'' as requestid,convert(varchar(20),a.fqr)+'_'+convert(varchar(20),a.id) as keyid,'' as bdbh,null as khzgdf,'' as khpjdj,'' as khpjdjname,a.ygkhqz from uf_ygjxzbzdk a,hrmresource d  where  a.fqr=d.id  and d.departmentid not in(11) and a.jxssbm in(11) and d.status<5 and a.khzqnf='2019' and a.khzq='11' and not exists (select 1 from formtable_main_51 where xzyzdd=a.id ) 
