select b.id as ryid,b.lastname,b.workcode,a.sjbm,b.jobtitle,a.erjm,'已评价' as status,a.khzqnf as year,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='formtable_main_51' and ta.fieldname='khzq' and tc.selectvalue=a.khzq) as zq, a.requestid,convert(varchar(20),a.requestid) as keyid,a.bdbh,a.khzgdf,a.khpjdj,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='formtable_main_51' and ta.fieldname='khpjdj' and tc.selectvalue=a.khpjdj) as khpjdjname,a.ygkhqz from formtable_main_51 a,hrmresource b,workflow_requestbase c  where  a.fqr=b.id and a.requestId=c.requestid and c.currentnodetype=3 and b.departmentid in(11) and b.status<5 and a.khzqnf='2019' and a.khzq='11' 
union all 
select t.id as ryid,t.lastname,t.workcode,case when (select supdepid from hrmdepartment where id=t.departmentid)=0 then null else t.departmentid end as sjbm,t.jobtitle,case when (select supdepid from hrmdepartment where id=t.departmentid)=0 then t.departmentid else (select supdepid from hrmdepartment where id=t.departmentid) end as erjm,'未制定' as status,'2019' as year, '5月' as zq,'' as requestid,convert(varchar(20),t.id)+'_0' as keyid,'' as bdbh from hrmresource t where t.id not in(select a.fqr from formtable_main_51 a where a.khzqnf='2019' and a.khzq='11') and t.departmentid in(11) and t.status<5 
union all 
select b.id as ryid,b.lastname,b.workcode,a.sjbm,b.jobtitle,a.erjm,'已制定' as status,a.khzqnf as year,(select tc.selectname from workflow_billfield ta, workflow_bill tb,workflow_selectitem tc where ta.billid=tb.id and tc.fieldid=ta.id  and tb.tablename='formtable_main_51' and ta.fieldname='khzq' and tc.selectvalue=a.khzq) as zq,a.rqid as requestid,convert(varchar(20),a.rqid) as keyid,a.bdbh from formtable_main_51 a ,hrmresource b where  a.fqr=b.id and b.departmentid not in(11) and a.jxssbm in(11) and a.khzqnf='2019' and a.khzq='11' and b.status<5