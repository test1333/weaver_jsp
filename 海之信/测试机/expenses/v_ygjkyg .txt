create view v_ygjkyg as
select convert(varchar(20),jkr)+'_'+convert(varchar(20),bz) as keyid,jkr,max(departmentid) as departmentid,bz as bzid,(select c.selectname from workflow_billfield a, workflow_bill b,workflow_selectitem c where a.billid=b.id and c.fieldid=a.id and b.tablename='uf_personal_borrow' and a.fieldname= 'bz' and c.selectvalue=bz) as bz,SUM(ISNULL(jkye,0)) as jkye,SUM(ISNULL(yqje,0)) as yqje from (select t.id,t.bz,t.jkye,isnull((select jkye from uf_personal_borrow where sfyq='0' and id=t.id),0) as yqje,t.jkr,(select departmentid from hrmresource where id=t.jkr) as departmentid from uf_personal_borrow t where ISNULL(t.jkye,0)>0 ) a  group by jkr,bz 